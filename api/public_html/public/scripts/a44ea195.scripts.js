"use strict";var app=angular.module("politicheckApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","ngAnimate","ui.keypress","mgo-angular-wizard","angulike","angular-spinkit","angular-intro"]),userRoles={visitor:1,user:2,admin:4},accessLevels={any:7,visitor:1,user:6,admin:4};app.config(["$routeProvider","$locationProvider",function(a){var b=accessLevels;a.when("/",{templateUrl:"views/landing.html",access:b.visitor}).when("/login",{templateUrl:"views/login.html",access:b.user}).when("/about",{templateUrl:"views/about.html",access:b.visitor}).when("/home",{templateUrl:"views/home.html",access:b.user}).when("/contact",{templateUrl:"views/home.html",access:b.user}).when("/register",{templateUrl:"views/login.html",access:b.visitor}).when("/tos",{templateUrl:"views/tos.html",access:b.visitor}).when("/user/verify/:accessCode",{templateUrl:"views/verify.html",access:b.visitor}).when("/profile",{templateUrl:"views/profile.html",access:b.user}).when("/history",{templateUrl:"views/history.html",access:b.user})}]),app.run(["$rootScope","$location","$cookieStore","$http","Auth",function(a,b,c,d,e){a.facebookAppId="345699855603648",a.urlRoot="http://ec2-54-172-95-254.compute-1.amazonaws.com:3000",a.lastSearch="",a.userRoles={visitor:1,user:2,admin:4},a.accessLevels={any:7,visitor:1,user:6,admin:4},a.user=c.get("user")||{username:"",isLogged:!1,role:userRoles.visitor},d.defaults.headers.common["x-auth"]=c.get("x-auth"),""==a.user.username||e.login(a.user,function(){},function(){}),a.$on("$routeChangeStart",function(c,d){a.error=null,a.success=null,d.access&a.user.role||b.path(a.user.role===userRoles.user||a.user.role===userRoles.admin?"/":"/login")})}]),app.controller("loginCtrl",["$scope","$http","Auth","$rootScope","$injector","$cookieStore",function(a,b,c,d,e,f){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],"undefined"==typeof f.get("user")?console.log("no cookie!"):(a.username=d.user.username||f.get("user").username,a.remember=d.user.remember||f.get("user").remember,a.password=d.user.password||f.get("user").password),a.login=function(){d.user.username=a.username,d.user.password=a.password,d.user.remember=a.remember,c.login(d.user,function(){},function(){})}}]),app.controller("navCtrl",["$scope","$http","Auth","$rootScope","$timeout","$cookieStore",function(a,b,c,d,e,f){b.defaults.headers.common["x-auth"]=f.get("token"),a.isLoggedIn=!1,a.navSelectedIndex=null,a.updateBillTotal=function(){b.get(d.urlRoot+"/user/bills/count").success(function(b){a.numberOfBillsVotedOn=b.count}).error(function(b){a.numberOfBillsVotedOn=0,console.log(b)})},a.toggle=function(){a.isLoggedIn=!a.isLoggedIn},a.logout=function(){c.logout()},a.navClicked=function(b){a.navSelectedIndex=b},a.$on("someoneLoggedIn",function(){a.toggle()}),a.$on("logOut",function(){a.toggle()}),a.$on("voteCast",function(){a.updateBillTotal()}),a.updateBillTotal()}]),app.controller("landingCtrl",["$scope","$http","$rootScope","$location","$timeout",function(a,b,c,d,e){a.noData=!1,a.IntroOptions={steps:[{element:document.querySelector("#step1"),intro:"<center>We look up all of your congress members for you.</center>",position:"left"},{element:document.querySelector("#step2"),intro:"<center>You vote on bills that affect you personally.</center>",position:"right"},{element:document.querySelector("#step3"),intro:"<center>And we calculate a repworthiness percentage.<br><br>The percentage <em>increases</em> if you agree with your representative, but it <div class='error'>decreases</div> if the represenative <em>disagrees or abstained from voting</em>.</center>",position:"left"},{element:document.querySelector("#step4"),intro:"<center>You can even pick topics that are interesting to you.</center>",position:"right"},{element:document.querySelector("#step5"),intro:"<center>Or you can search for bills by topic, name 'obamacare', or id 'hr5109'</center>"},{element:document.querySelector("#step6"),intro:"<center>And now voters can easily answer the question of whether or not to reelect or replace their congressman. <br><br> <strong>You can bet EasyBallot.org is going to change elections </strong> <br><br>  Share us on facebook and spread the word!<br><span fb-like></span></center>"}],showStepNumbers:!1,showProgress:!0,showBullets:!1,exitOnOverlayClick:!1,exitOnEsc:!0,nextLabel:"<strong>NEXT</strong>",prevLabel:'<span style="color:green">Previous</span>',skipLabel:"Exit Tour",doneLabel:"Exit Tour",overlayOpacity:"0.3"},a.showInitialLanding=!0,b.get("json/reps.json").success(function(b){a.reps=b}).error(function(a,b){console.log(a),console.log(b)}),b.get("json/bills.json").success(function(b){a.bills=b}).error(function(a,b){console.log(a),console.log(b)}),a.sendToLoginPage=function(){1!=c.user.isLogged&&d.path("/login")},a.$on("newSearch",function(){a.noData=!1,console.log("test")}),a.$on("search",function(){a.noData=!1,console.log("cleared out error message")}),a.$on("noData",function(){console.log("made it to the landing controller"),a.noData=!0,console.log(a.noData)}),a.BeforeChangeEvent=function(){},a.startTour=function(){console.log("started tour"),a.showInitialLanding=!1,a.showStep1=!0,e(function(){a.CallMe()},800)},a.CompletedEvent=function(){console.log("Completed Event called"),a.showInitialLanding=!0,a.showStep1=!1},a.ExitEvent=function(){console.log("Exit Event called"),a.showInitialLanding=!0,a.showStep1=!1}}]),app.controller("aboutCtrl",["$scope","$http","$rootScope","$location",function(a,b,c,d){a.sendToLoginPage=function(){1!=c.user.isLogged&&d.path("/login")}}]),app.controller("repCtrl",["$scope","$http","$rootScope","$location","$filter","$timeout",function(a,b,c,d,e,f){a.repImageURL="http://theunitedstates.io/images/congress/225x275/",a.repImageExtension=".jpg",a.id=[],b.get(c.urlRoot+"/user/reps").success(function(b){for(var c=[],d=0;d<b.length;d++)c[d]=b[d].worthiness,c[d]=e("number")(c[d],1);a.reps=[{firstName:b[0].first_name,lastName:b[0].last_name,bioguide_id:b[0].bioguide_id,repworthiness:c[0],role:"Senator"},{firstName:b[1].first_name,lastName:b[1].last_name,bioguide_id:b[1].bioguide_id,repworthiness:c[1],role:"Senator"},{firstName:b[2].first_name,lastName:b[2].last_name,bioguide_id:b[2].bioguide_id,repworthiness:c[2],role:"House Representative"}]}),c.$broadcast("voteCast"),a.$on("voteCast",function(){var d=(c.vote,[]);b.get(c.urlRoot+"/user/reps").success(function(b){d[0]=b[0].worthiness,d[1]=b[1].worthiness,d[2]=b[2].worthiness,a.id[0]=b[0].bioguide_id,a.id[1]=b[1].bioguide_id,a.id[2]=b[2].bioguide_id,a.percentHide=!0;for(var c=0;c<a.reps.length;c++){var g=[];g[c]=d[c],g[c]=e("number")(g[c],1),a.reps[c].repworthiness=g[c],a.reps[c].bioguide_id=b[c].bioguide_id,a.reps[c].imageURL=a.repImageURL+a.reps[c].bioguide_id+a.repImageExtension}f(function(){a.percentHide=!1},500),f(function(){a.percentShow=!0},1200)})})}]),angular.module("politicheckApp").controller("billCtrl",["$rootScope","$scope","$http","alertService","$filter","$timeout","Search",function(a,b,c,d,e,f,g){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.noData=!1,b.numberOfResults=0,b.billSummary="bill details loading...";a.closeAlert=d.closeAlert,b.share={Name:"EasyBallot.org",ImageUrl:"http://www.easyballot.org"},c.get(a.urlRoot+"/bills/recent").success(function(c){var d=c.results.slice(0,5),e={results:d};a.lastSearch="",a.numberOfResults=c.count,b.numberOfResults=c.count,g.clearBills(),g.setBills(e),a.$broadcast("search")}).error(function(a){console.log("got an error trying to get the most recent bills"),console.log(a)}),b.$on("newSearch",function(){b.noData=!1,b.numberOfResults=a.numberOfResults,f(function(){b.bills=g.getBills()},20)}),a.$on("search",function(){b.noData=!1,b.numberOfResults=a.numberOfResults,f(function(){b.bills=g.getBills()},900)}),b.$on("noData",function(){b.noData=!0}),b.remove=function(c){b.bills.splice(c,1),0==b.bills.length&&(console.log("out of bills!"),a.$emit("outOfBills"))},b.getBillSummary=function(d,e){console.log("title clicked"),c.get(a.urlRoot+"/bills/summary/"+e).success(function(a){b.billSummary=a[0].summary_short?a[0].summary_short:"Unfortunately, this bill is not yet out of committee, and we are still waiting for the summary from the bill's authors.",console.log(a);var c=b.billSummary.length;1004==c?(console.log("length: "+c),console.log("there is a long version of this bill")):(console.log("short summary only"),console.log("length: "+c))}).error(function(){b.billSummary="Bill summary not present or an error occurred"})},b.vote=function(e,g,h){var i=0,j=2e3,k="",l={method:"POST",url:a.urlRoot+"/user/bills/"+h+"/"+g,headers:{"Content-Type":"application/json"}};f(function(){b.remove(e)},i),a.vote=g,c(l).success(function(){console.log("Voted!!!!"),a.$broadcast("voteCast")}).error(function(a){console.log("error when voting!!!!"),console.log(a)}),k="1"==g?"yay":"nay",f(function(){d.add("success","Thanks for voting "+k+"!")},j)}}]),angular.module("politicheckApp").controller("searchCtrl",["$rootScope","$scope","$http","Search",function(a,b,c,d){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.enterPressed=function(a){b.search(b.searchText),a.preventDefault()},b.search=function(e){console.log("You searched for: "+e),d.clearBills(),b.$broadcast("clearSearch"),c.get(a.urlRoot+'/bills/search/?bill="'+e+'"&per_page=5').success(function(b){a.lastSearch=e,a.numberOfResults=b.count,console.log("number of results: "+a.numberOfResults),a.$broadcast("search"),d.setBills(b),0==b.results.length&&a.$broadcast("noData")}),b.newText=function(){a.$broadcast("newSearch")}}}]),app.controller("regCtrl",["$scope","$http","$rootScope","$location","alertService","Auth",function(a,b,c,d,e){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],c.reps=[],a.finishedWizard=function(){a.filters=[{name:"Most Recent",show:!0,query:"mostRecent"},{name:"Law Enforcement",show:a.$$childTail.interest.lawEnforcement,query:"law enforcement"},{name:"Education",show:a.$$childTail.interest.education,query:"education"},{name:"Health Care",show:a.$$childTail.interest.healthCare,query:"health care"},{name:"Veterans",show:a.$$childTail.interest.veterans,query:"veterans"},{name:"Children",show:a.$$childTail.interest.children,query:"children"},{name:"Minorities",show:a.$$childTail.interest.minority,query:"minority"},{name:"Foreign Aid",show:a.$$childTail.interest.foreignAid,query:"foreign aid"},{name:"Immigration",show:a.$$childTail.interest.immigration,query:"immigration"},{name:"Taxes",show:a.$$childTail.interest.taxes,query:"taxes"},{name:"Defense Spending",show:a.$$childTail.interest.defenseSpending,query:"defense spending"},{name:"Privacy",show:a.$$childTail.interest.privacy,query:"privacy"},{name:"Disaster Relief",show:a.$$childTail.interest.disasterRelief,query:"disaster relief"},{name:"Religion",show:a.$$childTail.interest.religion,query:"religion"},{name:"Women's Rights",show:a.$$childTail.interest.abortion,query:"abortion"},{name:"LGBT",show:a.$$childTail.interest.lgbt,query:"lgbt"}];var d={method:"POST",url:c.urlRoot+"/user",headers:{"Content-Type":"application/json"},data:{_id:a.$$childTail.email,password:a.$$childTail.passwordA,age:a.$$childTail.age,senators:[{id:a.$$childTail.reps[0],disagree:0},{id:a.$$childTail.reps[1],disagree:0},{id:a.$$childTail.reps[2],disagree:0}],firstName:a.$$childTail.firstName,lastName:a.$$childTail.lastName,sex:a.$$childTail.sex,tos:a.$$childTail.tos,share:a.$$childTail.share,address:a.$$childTail.address,zipcode:a.$$childTail.zipcode,state:a.$$childTail.state,district:a.$$childTail.district,filters:a.filters}};b(d).success(function(){e.add("registered","Successfully registered."),c.user.username=a.$$childTail.email,c.user.password=a.$$childTail.passwordA,c.user.remember=!0,d={}}).error(function(a,b){400==b&&e.add("already_registered","Sorry, that user is already registered.")})},a.updateGeneralInfo=function(){a.validStepOne=!1,a.validFirstName=!1,a.validLastName=!0,a.validEmail=!1,a.validPasswordA=!1,a.validPasswordB=!1,a.validPasswordMatch=!1,a.validAge=!1,a.validSex=!1,a.validTOS=!1,a.$$childTail.firstName&&(a.validFirstName=!0),a.$$childTail.lastName&&(a.validLastName=!0),a.$$childTail.email&&(a.validEmail=!0),a.$$childTail.passwordA&&(a.validPasswordA=!0),a.$$childTail.passwordB&&(a.validPasswordB=!0),a.$$childTail.passwordA==a.$$childTail.passwordB?(a.validPasswordMatch=!0,a.$$childTail.validPasswordMatch=!0):(a.validPasswordMatch=!1,a.$$childTail.validPasswordMatch=!1),a.$$childTail.age&&(a.validAge=!0),a.$$childTail.sex&&(a.validSex=!0),a.$$childTail.tos&&(a.validTOS=!0),a.$$childTail.validStepOne=a.validFirstName&&a.validLastName&&a.validEmail&&a.validPasswordA&&a.validPasswordB&&a.validAge&&a.validSex&&a.validTOS&&a.validPasswordMatch},a.validateContact=function(){console.log("first step completed!"),a.updateLocationInfo=function(){a.validStepThree=!1,a.validZipcode=!1,a.$$childTail.zipcode&&(a.validZipcode=!0)}},a.districtChosen=function(b){a.$$childTail.state=a.$$childTail.districts[b].state,a.$$childTail.district=a.$$childTail.districts[b].district,a.$$childTail.rep=a.$$childTail.districts[b].first_name+" "+a.$$childTail.districts[b].last_name,a.$$childTail.reps[2]=a.$$childTail.districts[b].bioguide_id,a.validStepThree=!0},a.findReps=function(){a.address="",a.zipcode="",a.showMap=!1,a.pickDistrict=!1,a.showDistricts=!1;{var d={method:"POST",url:c.urlRoot+"/user/legislators",headers:{"Content-Type":"application/json"},data:{streetAddress:a.address,zipcode:a.zipcode}};({method:"POST",url:c.urlRoot+"/user/reps",headers:{"Content-Type":"application/json"},data:[]})}if(a.$$childTail.address)a.address=a.$$childTail.address.replace(/ /g,"+"),a.zipcode=a.$$childTail.zipcode,d.data={streetAddress:a.address,zipcode:a.zipcode},b(d).success(function(b){if(3==b.results.length){for(a.i=0;a.i<b.results.length;a.i++)"house"==b.results[a.i].chamber&&(a.repIndex=a.i);a.findSenatorIndexes=3-a.repIndex,3==a.findSenatorIndexes&&(b.results[1].last_name<b.results[2].last_name?(a.senatorAIndex=1,a.senatorBIndex=2):(a.senatorAIndex=2,a.senatorBIndex=1)),2==a.findSenatorIndexes&&(b.results[0].last_name<b.results[2].last_name?(a.senatorAIndex=0,a.senatorBIndex=2):(a.senatorAIndex=2,a.senatorBIndex=0)),1==a.findSenatorIndexes&&(b.results[0].last_name<b.results[1].last_name?(a.senatorAIndex=0,a.senatorBIndex=1):(a.senatorAIndex=1,a.senatorBIndex=0))}a.$$childTail.senatorA=b.results[a.senatorAIndex].first_name+" "+b.results[a.senatorAIndex].last_name,a.$$childTail.senatorB=b.results[a.senatorBIndex].first_name+" "+b.results[a.senatorBIndex].last_name,a.$$childTail.rep=b.results[a.repIndex].first_name+" "+b.results[a.repIndex].last_name,a.$$childTail.reps=[b.results[a.senatorAIndex].bioguide_id,b.results[a.senatorBIndex].bioguide_id,b.results[a.repIndex].bioguide_id],a.$$childTail.validStepThree=!0}).error(function(a,b){console.log(a),404===b&&(console.log("bad zipcode"),e.add("zipcode_error","Sorry, incorrect zipcode.")),500===b&&e.add("server_error","Sorry, server error.  Please try again.")});else if(a.$$childTail.zipcode){a.zipcode=JSON.stringify(a.$$childTail.zipcode);var f={method:"GET",url:c.urlRoot+"/zipcode/"+a.zipcode+"/reps",headers:{"Content-Type":"application/json"}};b(f).success(function(b){for(a.i=0;a.i<b.results.length;a.i++)if("senate"==b.results[a.i].chamber){a.tempAIndex=a.i;break}for(a.i=a.tempAIndex+1;a.i<b.results.length;a.i++)"senate"==b.results[a.i].chamber&&(a.tempBIndex=a.i);b.results[a.tempAIndex].last_name<b.results[a.tempBIndex].last_name?(a.senatorAIndex=a.tempAIndex,a.senatorBIndex=a.tempBIndex):(a.senatorAIndex=a.tempBIndex,a.senatorBIndex=a.tempAIndex),a.$$childTail.reps=[b.results[a.senatorAIndex].bioguide_id,b.results[a.senatorBIndex].bioguide_id,"???????"],a.$$childTail.senatorA=b.results[a.senatorAIndex].first_name+" "+b.results[a.senatorAIndex].last_name,a.$$childTail.senatorB=b.results[a.senatorBIndex].first_name+" "+b.results[a.senatorBIndex].last_name,a.senatorAIndex>a.senatorBIndex?(b.results.splice(a.senatorAIndex,1),b.results.splice(a.senatorBIndex,1)):(b.results.splice(a.senatorBIndex,1),b.results.splice(a.senatorAIndex,1)),a.$$childTail.districts=b.results.slice(),1==b.results.length?(a.$$childTail.pickDistrict=!1,a.$$childTail.showMap=!1,a.$$childTail.showDistricts=!1,a.districtChosen(0)):(a.$$childTail.pickDistrict=!0,a.$$childTail.showMap=!0,a.$$childTail.showDistricts=!0,a.$$childTail.rep="[Click Green District Button Using Map]")}).error(function(a,b){console.log(a),console.log("status : "+b)})}}}]),angular.module("politicheckApp").controller("filterCtrl",["$rootScope","$scope","$http","alertService","$filter","$timeout","Search",function(a,b,c,d,e,f,g){b.selectedIndex=0,b.filters=[{name:"Most Recent",show:!0,query:"mostRecent"},{name:"Women's Issues",show:!0,query:"Abortion"},{name:"Taxes",show:!0,query:"taxes"},{name:"LGBT",show:!1,query:"gay"}],c.get(a.urlRoot+"/user/filters").success(function(a){b.filters=a}).error(function(a){console.log("error occurred getting filters"),console.log(a),b.filters=[{name:"Most Recent",show:!0,query:"mostRecent"},{name:"Health Care",show:!0,query:"health care"},{name:"Taxes",show:!0,query:"taxes"},{name:"Jobs",show:!0,query:"jobs"}]}),b.filterSearch=function(d,e){b.selectedIndex=e,"mostRecent"==d?c.get(a.urlRoot+"/bills/recent").success(function(b){var c=b.results.slice(0,5),d={results:c};a.numberOfResults=b.count,console.log("filter most recent number of results: "+a.numberOfResults),a.lastSearch="",g.clearBills(),g.setBills(d),a.$broadcast("search")}).error(function(a){console.log("got an error trying to get the most recent bills"),console.log(a)}):(g.clearBills(),c.get(a.urlRoot+'/bills/search/?bill="'+d+'"&per_page=5').success(function(b){a.lastSearch=d,console.log(a.lastSearch),a.numberOfResults=b.count,console.log("filter number of results: "+a.numberOfResults),g.setBills(b),a.$broadcast("search"),0==b.results.length&&a.$broadcast("noData")}).error(function(a,b){console.log("couldn't find anything"),console.log(b),console.log(a)}))}}]),app.controller("contactCtrl",["$scope","$http","$rootScope","$location","alertService",function(a,b,c,d,e){a.disableSend=!0,a.contactUsMessage="",a.subject="",a.updateContactUsForm=function(){a.disableSend=""!=a.contactUsMessage&&""!=a.subject?!1:!0},a.sendEmailToAdmin=function(){e.add("email_sent","Thanks!  Your email has been sent.");var d={method:"POST",url:c.urlRoot+"/contact",headers:{"Content-Type":"application/json"},data:{subject:a.subject,body:a.contactUsMessage}};b(d).success(function(a){console.log(a)}).error(function(a,b){console.log(a),console.log(b)})}}]),app.controller("paginationCtrl",["$scope","$http","$rootScope","$location","Search","$timeout",function(a,b,c,d,e,f){a.searchFinished=!0,a.totalItems=64,a.currentPage=1,a.maxSize=5,f(function(){a.bigTotalItems=c.numberOfResults,a.bigTotalItems>25||(a.maxSize=Math.ceil(a.bigTotalItems/5))},500),a.bigCurrentPage=1,c.$on("noData",function(){a.searchFinished=!1,console.log("hide bar, no data")}),c.$on("search",function(){a.searchFinished=!0,a.bigTotalItems=c.numberOfResults,a.bigTotalItems>25||f(function(){console.log("new # results"+c.numberOfResults),a.bigTotalItems>25},100)}),c.$on("outOfBills",function(){a.setPage(a.bigCurrentPage+1)}),a.calculateMaxSize=function(){a.bigTotalItems/5>=5||(a.maxSize=Math.ceil(a.bigTotalItems/5))},a.setPage=function(b){a.bigCurrentPage=b,a.pageChanged()},a.pageChanged=function(){console.log("Page changed to: "+a.bigCurrentPage),console.log("last Search from paginationCtrl:"+c.lastSearch),""==c.lastSearch?b.get(c.urlRoot+"/bills/recent/?per_page=5&page="+a.bigCurrentPage).success(function(b){a.bigTotalItems=b.count,c.numberOfResults=b.count,a.calculateMaxSize();var d=b.results.slice(0,5),f={results:d};c.lastSearch="",e.clearBills(),e.setBills(f),c.$broadcast("search")}).error(function(a){console.log("got an error trying to get the most recent bills"),console.log(a)}):(console.log(a.bigTotalItems),e.clearBills(),b.get(c.urlRoot+'/bills/search/?bill="'+c.lastSearch+'"&per_page=5&page='+a.bigCurrentPage).success(function(b){console.log('/bills/search?query="'+c.lastSearch+'"&per_page=5&page='+a.bigCurrentPage),console.log("count "+b.count),a.bigTotalItems=b.count,a.calculateMaxSize(),c.numberOfResults=b.count,e.setBills(b),c.$broadcast("search"),0==b.results.length&&c.$broadcast("noData"),console.log("count "+b.count)}).error(function(a,b){console.log(a),console.log(b)}))}}]),angular.module("politicheckApp").controller("verifyCtrl",["$scope","$http","$location","$routeParams","$rootScope",function(a,b,c,d,e){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],console.log(d.accessCode),a.error=!1;var f={method:"POST",url:e.urlRoot+"/user/verify/"+d.accessCode,headers:{"Content-Type":"application/json"}};b(f).success(function(){c.path("/login")}).error(function(){a.error=!0})}]),angular.module("politicheckApp").controller("profileCtrl",["$rootScope","$scope","$http","alertService","$filter","$timeout","Search","$location","$cookieStore",function(a,b,c,d,e,f,g,h,i){b.senAFirstName="",b.senALastName="",b.senBFirstName="",b.senBLastName="",b.repFirstName="",b.repLastName="",c.get(a.urlRoot+"/user/reps").success(function(a){b.senAFirstName=a[0].first_name,b.senALastName=a[0].last_name,b.senBFirstName=a[1].first_name,b.senBLastName=a[1].last_name,b.repFirstName=a[2].first_name,b.repLastName=a[2].last_name,b.senatorA=a[0].first_name+" "+a[0].last_name,b.senatorB=a[1].first_name+" "+a[1].last_name,b.rep=a[2].first_name+" "+a[2].last_name}).error(function(a,b){console.log(a),console.log(b)}),c.get(a.urlRoot+"/user/profile").success(function(a){b.firstName=a.firstName,b.lastName=a.lastName,b.age=a.age,b.sex=a.sex,b.address=a.address,b.zipcode=a.zipcode,b.filters=a.filters,b.share=a.share,b.previousSenators=a.senators}).error(function(a,b){console.log(a),console.log(b)}),b.setUpNewReps=function(){b.newSenators=[{id:null,disagree:null,novote:null},{id:null,disagree:null,novote:null},{id:null,disagree:null,novote:null}],console.log("old reps: "),console.log(b.previousSenators),console.log("new reps: "),console.log(b.reps);for(var a=0;3>a;a++)b.newSenators[a].id=b.previousSenators[a].id,b.newSenators[a].disagree=b.previousSenators[a].disagree,b.newSenators[a].novote=b.previousSenators[a].novote;for(var c=0;3>c;c++)b.newSenators[c].id==b.reps[c]||(b.newSenators[c].id=b.reps[c],b.newSenators[c].disagree=0,b.newSenators[c].novote=0);console.log("finished reps"),console.log(b.newSenators);for(var d=0;3>d;d++)b.newSenators[d].id==b.previousSenators[d].id&&(b.newSenators[d].disagree=b.previousSenators[d].disagree,b.newSenators[d].novote=b.previousSenators[d].novote)},b.returnHome=function(){h.path("/home")},b.saveProfile=function(){console.log("save my profile"),swal({title:"Are you sure?",text:"Are you sure you want to update your profile?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"Yes, update my profile!",closeOnConfirm:!1},function(){swal("Success!","Your profile has been updated.","success")}),console.log("...please");var d=i.get("token");d||(d=a.user.authtoken);var e={method:"PUT",url:a.urlRoot+"/user/profile",headers:{"Content-Type":"application/json","x-auth":d},data:{age:b.age,senators:b.newSenators,firstName:b.firstName,lastName:b.lastName,sex:b.sex,share:b.share,address:b.address,zipcode:b.zipcode,state:b.state,district:b.district,filters:b.filters}};c(e).success(function(){}).error(function(a,b){console.log(a),console.log(b)})},b.districtChosen=function(a){console.log("district chosen!"),b.state=b.districts[a].state,b.district=b.districts[a].district,b.rep=b.districts[a].first_name+" "+b.districts[a].last_name,console.log(b.rep),b.reps[2]=b.districts[a].bioguide_id,b.setUpNewReps()},b.updateLocation=function(){b.unlessZipIsBlank=!1,b.zipcode&&(b.unlessZipIsBlank=!0),console.log(b.zipcode)},b.findReps=function(){console.log("made it"),b.showMap=!1,b.pickDistrict=!1,b.showDistricts=!1;{var e={method:"POST",url:a.urlRoot+"/user/legislators",headers:{"Content-Type":"application/json"},data:{streetAddress:b.address,zipcode:b.zipcode}};({method:"POST",url:a.urlRoot+"/user/reps",headers:{"Content-Type":"application/json"},data:[]})}if(b.address)b.addressModified=b.address.replace(/ /g,"+"),e.data={streetAddress:b.addressModified,zipcode:b.zipcode},c(e).success(function(a){if(3==a.results.length){for(b.i=0;b.i<a.results.length;b.i++)"house"==a.results[b.i].chamber&&(b.repIndex=b.i);b.findSenatorIndexes=3-b.repIndex,3==b.findSenatorIndexes&&(a.results[1].last_name<a.results[2].last_name?(b.senatorAIndex=1,b.senatorBIndex=2):(b.senatorAIndex=2,b.senatorBIndex=1)),2==b.findSenatorIndexes&&(a.results[0].last_name<a.results[2].last_name?(b.senatorAIndex=0,b.senatorBIndex=2):(b.senatorAIndex=2,b.senatorBIndex=0)),1==b.findSenatorIndexes&&(a.results[0].last_name<a.results[1].last_name?(b.senatorAIndex=0,b.senatorBIndex=1):(b.senatorAIndex=1,b.senatorBIndex=0))}b.senatorA=a.results[b.senatorAIndex].first_name+" "+a.results[b.senatorAIndex].last_name,b.senatorB=a.results[b.senatorBIndex].first_name+" "+a.results[b.senatorBIndex].last_name,b.rep=a.results[b.repIndex].first_name+" "+a.results[b.repIndex].last_name,b.reps=[a.results[b.senatorAIndex].bioguide_id,a.results[b.senatorBIndex].bioguide_id,a.results[b.repIndex].bioguide_id],b.setUpNewReps()}).error(function(a,b){console.log(a),404===b&&(console.log("bad zipcode"),d.add("zipcode_error","Sorry, incorrect zipcode.")),500===b&&d.add("server_error","Sorry, server error.  Please try again.")});else if(b.zipcode){b.zipcodeStringified=JSON.stringify(b.zipcode);var f={method:"GET",url:a.urlRoot+"/zipcode/"+b.zipcodeStringified+"/reps",headers:{"Content-Type":"application/json"}};c(f).success(function(a){for(b.i=0;b.i<a.results.length;b.i++)if("senate"==a.results[b.i].chamber){b.tempAIndex=b.i;break}for(b.i=b.tempAIndex+1;b.i<a.results.length;b.i++)"senate"==a.results[b.i].chamber&&(b.tempBIndex=b.i);a.results[b.tempAIndex].last_name<a.results[b.tempBIndex].last_name?(b.senatorAIndex=b.tempAIndex,b.senatorBIndex=b.tempBIndex):(b.senatorAIndex=b.tempBIndex,b.senatorBIndex=b.tempAIndex),b.reps=[a.results[b.senatorAIndex].bioguide_id,a.results[b.senatorBIndex].bioguide_id,"???????"],b.senatorA=a.results[b.senatorAIndex].first_name+" "+a.results[b.senatorAIndex].last_name,b.senatorB=a.results[b.senatorBIndex].first_name+" "+a.results[b.senatorBIndex].last_name,b.senatorAIndex>b.senatorBIndex?(a.results.splice(b.senatorAIndex,1),a.results.splice(b.senatorBIndex,1)):(a.results.splice(b.senatorBIndex,1),a.results.splice(b.senatorAIndex,1)),b.districts=a.results.slice(),console.log("districts: "),console.log(b.districts),1==a.results.length?(b.pickDistrict=!1,b.showMap=!1,b.showDistricts=!1,b.districtChosen(0)):(b.pickDistrict=!0,b.showMap=!0,b.showDistricts=!0,b.rep="[Click Green District Button Using Map]"),b.setUpNewReps()}).error(function(a,b){console.log(a),console.log("status : "+b)})}}}]),app.controller("historyCtrl",["$scope","$http","$rootScope","$location","alertService","$timeout",function(a,b,c,d,e,f){a.loading=!0,b.get(c.urlRoot+"/user/reps").success(function(b){a.senAFirstName=b[0].first_name,a.senALastName=b[0].last_name,a.senBFirstName=b[1].first_name,a.senBLastName=b[1].last_name,a.repFirstName=b[2].first_name,a.repLastName=b[2].last_name}).error(function(a,b){console.log(a),console.log(b)}),a.formatVotes=function(b){for(var c=0;c<b.length;c++){b[c].uservote=1==b[c].uservote?"Yea":"Nay";for(var d=0;3>d;d++)"Not Voting"==b[c].senatorVotes[d].vote&&(b[c].senatorVotes[d].vote="Abstained")}a.bills=b},a.formatBillTitle=function(b){for(var c=0;c<b.length;c++)null==b[c].bill.short_title&&(b[c].bill.short_title=b[c].bill.official_title.slice(0,70));a.bills=b},a.vote=function(a,d){var g=2e3,h={method:"POST",url:c.urlRoot+"/user/bills/"+d+"/"+a,headers:{"Content-Type":"application/json"}};c.vote=a,b(h).success(function(){c.$broadcast("voteCast")}).error(function(a){console.log("error when voting!!!!"),console.log(a)});var i;1==a?i="Yea":0==a&&(i="Nay"),f(function(){e.add("success","Thanks for changing your vote to "+i+"!")},g)},a.changeVote=function(b){var c,d,e;e=a.bills[b].bill.bill_id,c=a.bills[b].uservote,"Nay"==c?(c="Yea",d=1):"Yea"==c&&(c="Nay",d=0),a.bills[b].uservote=c,a.vote(d,e)},b.get(c.urlRoot+"/user/bills?per_page=10").success(function(b){a.bills=b.bills,a.formatVotes(a.bills),a.formatBillTitle(a.bills),a.loading=!1}).error(function(a,b){console.log(a),console.log(b)}),a.$on("historyPageChange",function(){a.loading=!0,a.page=c.historyPage,b.get(c.urlRoot+"/user/bills?per_page=10&page="+a.page).success(function(b){a.bills=b.bills,a.formatVotes(a.bills),a.formatBillTitle(a.bills),a.loading=!1}).error(function(a,b){console.log(a),console.log(b)})})}]),app.controller("historyPaginationCtrl",["$scope","$http","$rootScope","$location","alertService","$timeout",function(a,b,c){a.showHistoryPagination=!0,b.get(c.urlRoot+"/user/bills?&per_page=10").success(function(b){a.bigTotalItems=b.count,a.showHistoryPagination=null==b.count||0==b.count?!1:!0}).error(function(b,c){console.log(b),console.log(c),a.showHistoryPagination=!1}),a.bigTotalItems>50&&(a.maxSize=5),a.pageChanged=function(){console.log("page changed"),console.log(a.bigCurrentPage),c.historyPage=a.bigCurrentPage,c.$broadcast("historyPageChange")}}]),angular.module("politicheckApp").directive("pop",["$animate",function(a){return{template:"",restrict:"A",link:function(b,c){c.hover(function(){c.preventDefault,c.hasClass("rubberBand")&&c.removeClass("rubberBand"),c.hasClass("animated")||c.addClass("animated"),c.hasClass("pulse")||a.addClass(c,"pulse")},function(){c.hasClass("pulse")&&c.removeClass("pulse")})}}}]),angular.module("politicheckApp").directive("votePercentAnimation","$animate",function(){return{template:"",restrict:"A",link:function(a,b,c){a.$watch(c.votePercentAnimation,function(a,b){a!=b&&console.log("test")})}}}),angular.module("politicheckApp").directive("autoFocus",["$timeout",function(a){return{restrict:"AC",link:function(b,c){a(function(){c[0].focus()},0)}}}]),angular.module("politicheckApp").directive("fadeMiddle",["$animate",function(a){return{template:"",restrict:"A",link:function(b,c){c.hover(function(){c.preventDefault,c.$middle&&(c.removeClass("fadeLast"),c.addClass("fadeMiddle")),c.hasClass("animated")||c.addClass("animated"),c.hasClass("fadeMiddle")||a.addClass(c,"fadeMiddle"),$compile(c)(b)},function(){})}}}]),angular.module("politicheckApp").factory("Auth",["$http","$rootScope","$cookieStore","$location","alertService",function(a,b,c,d,e){return{authorize:function(a,c){return void 0===c&&(c=b.user.role),a&c},logMeIn:function(){alert("working")},isLoggedIn:function(a){return void 0===a&&(a=b.user),a.role===userRoles.user||a.role===userRoles.admin},register:function(){},login:function(f){b.user=f;var g={method:"POST",url:b.urlRoot+"/user/login",headers:{"Content-Type":"application/json","x-username":f.username,"x-password":f.password,"x-rememberme":f.remember}};a(g).success(function(g){console.log("Logged in!");var h=g.token;a.defaults.headers.common["x-auth"]=h,c.put("user",b.user),c.put("token",h),e.add("login","Welcome, "+b.user.username+"!"),b.user={username:f.username,isLogged:!0,role:userRoles.user,authtoken:h},b.user=f,b.user.isLogged=!0,b.user.role=b.userRoles.user,b.$broadcast("someoneLoggedIn"),d.path("/home")}).error(function(a,b){404===b&&(console.log("bad login combo"),e.add("login_error","Sorry, incorrect user name or password combination."))})},logout:function(){console.log("Logged out!"),b.user.username="",b.user.isLogged=!1,b.user.role=b.userRoles.visitor,c.remove("token"),c.remove("user"),b.$broadcast("logOut"),d.path("/")}}}]),angular.module("politicheckApp").factory("alertService",["$rootScope","$timeout",function a(b,c){var a={};return b.alerts=[],a.add=function(a,d){b.alerts.push({type:a,msg:d}),c(function(){b.alerts.splice(0,1)},2e3)},a.closeAlert=function(a){b.alerts.splice(a,1)},a}]),angular.module("politicheckApp").factory("Search",["$http","$rootScope",function(){var a=[];return{getBills:function(){return a
},setBills:function(b){a=b.results;for(var c=0;c<a.length;c++)null==a[c].short_title&&(a[c].short_title=a[c].official_title.slice(0,45)+" ...")},clearBills:function(){a&&(a.length=0)}}}]);